<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="css/weui.min.css">
  <link rel="stylesheet" href="css/jquery-weui.min.css">
  <link rel="stylesheet" href="css/swiper.min.css">
  <link rel="stylesheet" href="css/index1.css">
  <link rel="stylesheet" href="http://at.alicdn.com/t/font_488112_jwsm2fctrw.css">

</head>

<body class="shop_index">
  <div class="menu-fixed">
    <header class="head bgc-t">
      <div class="fanhui back" id="back">
        <a href="javascript:;"><img src="images/back.png"></a>
      </div>
      <div class="span1 c000">淘宝</div>
      <div class="gengduo">
        <a href="my.html"> <i class="iconfont icon-person_line"></i></a>

      </div>

    </header>
    <div class="weui_search_bar bgc-t" id="search_bar">
      <form class="weui_search_outer">
        <div class="weui_search_inner">
          <i class="weui_icon_search"></i>
          <input type="search" class="weui_search_input" id="search_input" placeholder="商品名称" required />
          <a href="javascript:" class="weui_icon_clear" id="search_clear"></a>
        </div>
        <label for="search_input" class="weui_search_text" id="search_text">
          <i class="weui_icon_search"></i>
          <span>商品名称</span>
        </label>
      </form>
      <a href="javascript:" class="weui_search_ok" id="search">查询</a>
    </div>
    <div class="swiper-container swiper_taobao swiper1" style="display: none">
      <div class="swiper-wrapper ">
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tb1.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tb2.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tb3.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tb4.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tb5.jpg">
          </a>
        </div>
      </div>
      <div class="swiper-pagination" style="bottom: 5px;"></div>
    </div>
    <div class="swiper-container swiper_tianmao swiper1" style="display: none">
      <div class="swiper-wrapper ">
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tm1.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tm2.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tm3.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tm4.jpg">
          </a>
        </div>
        <div class='swiper-slide'>
          <a href='javascript:;'>
            <img class='news-row-center w100' src="images/tm5.jpg">
          </a>
        </div>
      </div>
      <div class="swiper-pagination" style="bottom: 5px;"></div>
    </div>
    <div class="swiper-container  swiper2 bcfff">
      <div class="swiper-wrapper">
        <div class='swiper-slide'>
          <div class="weui-row" id="menu">
          </div>
        </div>
        <div class='swiper-slide'>
          <div class="weui-row" id="menu1">
          </div>
        </div>
        <div class='swiper-slide'>
          <div class="weui-row" id="menu2">
          </div>
        </div>
        <div class='swiper-slide'>
          <div class="weui-row" id="menu3">
          </div>
        </div>
        <div class='swiper-slide'>
          <div class="weui-row" style="width: 94%" id="menu4">
          </div>
        </div>
      </div>
    </div>
    <div class="goods-search-list-nav">
      <ul id="nav_ul">
        <li><a href="javascript:void(0);" class="choice_unit current posr" id="sort_default">综合<span class="bottom"
              data-name=""></span></a></li>
        <li><a href="javascript:void(0);" class="choice_unit posr" id="search_adv">销量<span class="top"
              data-name="total_sales_asc">234</span><span data-name="total_sales_des" class="bottom"></span></a></li>
        <li><a href="javascript:void(0);" class="choice_unit posr" id="price">价格<span class="top"
              data-name="price_asc"></span><span class="bottom" data-name="price_des"></span></a></li>
      </ul>
      <div class="browse-mode"><a href="javascript:void(0);" id="show_style"><span class="browse-list"></span></a></div>

    </div>
  </div>

  <div class="container-index posr">
    <div style="background-color: #f5f5f5;height:10px;width:100%;"></div>
    <!-- <div class="menu">
            <ul id="menu">
            </ul>
        </div> -->
    <div class="container product-list" name="product-list">

    </div>
    <div class="comment_nextpage loading-more" style="position: absolute;bottom:0rem;left: 35%;">
      <div class="weui-infinite-scroll" style="padding-bottom:12px;">
        <img src="./images/loading.gif" style="vertical-align: middle;width: initial">
        正在加载...
      </div>
    </div>
    <div class="comment_nextpage loading-more1" style="position: absolute;bottom:0rem;left: 35%;display: none">
      <div class="weui-infinite-scroll" style="padding-bottom:12px;">
        已经到底了
      </div>
    </div>
  </div>
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/swiper.min.js"></script>
  <script src="js/jquery-weui.min.js"></script>
  <script src="js/index.js"></script>
  <script type="text/javascript">
    var loadMenuComplete = false;
    var loadItemComplete = false;
    var isEnd = false;
    var search = {
      pager_offset: 1,
      category_code: "",
      product_name: "数码",
      sort: ''
    }
    $.getUrlParam = function (name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
      var r = window.location.search.substr(1).match(reg);
      if (r != null) return unescape(r[2]);
      return null;
    }
    var shop_class = $.getUrlParam('params');
    shop_class = "tianmao"
    if (shop_class != null) {
      localStorage.setItem("shop_class", shop_class);
    } else {
      shop_class = localStorage.getItem("shop_class");
    }

    // window.jsInterface.getUserId();

    function callbackUserId(uid) {
      uid = 100161
      if (uid) {
        localStorage.setItem("uid", uid);
      }
    }
    $(function () {
      callbackUserId()
      $.ajax({
        type: "GET",
        url: "http://47.99.93.123:9090/rest/getCategory",
        dataType: "json",
        data: {
          parentId: 0,
          grade: 0
        },
        success: function (response) {
          $("#menu").html("");
          loadMenuComplete = true;
          var data = response.data;
          console.log(data)
          if (data && data.length > 0) {
            var data1 = data.slice(0, 10)
            var data2 = data.slice(10, 20)
            var data3 = data.slice(20, 30)
            var data4 = data.slice(30, 40)
            var data5 = data.slice(40, data.length)
            $.each(data1, function (index, item) {
              $("#menu").append("<div class='weui-col-20' data-test='" + item.name + "' data-code='" +
                item.id +
                "'><span>" + item.name + "</span></div>");
            });
            $.each(data2, function (index, item) {
              $("#menu1").append("<div class='weui-col-20' data-test='" + item.name +
                "' data-code='" + item.id +
                "'>" + item.name + "</div>");
            });
            $.each(data3, function (index, item) {
              $("#menu2").append("<div class='weui-col-20' data-test='" + item.name +
                "' data-code='" + item.id +
                "'>" + item.name + "</div>");
            });
            $.each(data4, function (index, item) {
              $("#menu3").append("<div class='weui-col-20' data-test='" + item.name +
                "' data-code='" + item.id +
                "'>" + item.name + "</div>");
            });
            $.each(data5, function (index, item) {
              $("#menu4").append("<div class='weui-col-20' data-test='" + item.name +
                "' data-code='" + item.id +
                "'>" + item.name + "</div>");
            });
            $("#menu .weui-col-20,#menu1 .weui-col-20").click(function (e) {
              if (e && e.target) {
                $("#search_input").val("");
                var event = e.target;
                search.category_code = search.category_code ? search.category_code : "";
                search.sort = search.sort ? search.sort : "";
                search.pager_offset = 1;
                search.product_name = $(this).data('test');
                $("div[name='product-list']").html("");
                getPageList(search);
              }
            });
          }
        }
      });
      init();
    })


    function init() {
      $("div[name='product-list']").html("");
      getPageList();
    }
    $("body").on("click", "#nav_ul li", function () {
      $('#nav_ul li').find('.choice_unit').removeClass("current");
      search.category_code = search.category_code ? search.category_code : "";
      search.product_name = search.product_name ? search.product_name : "";
      search.pager_offset = 1;
      $(this).find('.choice_unit').addClass("current");
      if ($(this).find('span.top').hasClass('current')) {
        $('#nav_ul li span.top,#nav_ul li span.bottom').removeClass("current");
        $(this).find('span.bottom').addClass("current").siblings().removeClass("current");
        var aaa = $(this).find('span.bottom').data('name');
        search.sort = $(this).find('span.bottom').data('name');
      } else {
        $('#nav_ul li span.top,#nav_ul li span.bottom').removeClass("current");
        $(this).find('span.top').addClass("current").siblings().removeClass("current");
        search.sort = $(this).find('span.top').data('name');
      }
      $("div[name='product-list']").html("");
      getPageList(search);

    })
    $("#search").click(function () {
      search.product_name = $("#search_input").val();
      search.category_code = search.category_code ? search.category_code : "";
      search.sort = search.sort ? search.sort : "";
      search.pager_offset = 1;
      if (search.product_name == '') {
        $.showDialog({
          content: "请输入搜索内容",
          type: "toast",
          duration: 2000,
          okCallback: function () {}
        });
        return false;
      } else {
        $("div[name='product-list']").html("");
        getPageList(search);

      }

    });
    $("div[name='product-list']").click(function (e) {
      if (e && e.target) {
        var target = e.target;
        var product_code = 0;
        if (target.dataset && target.dataset.code) {
          product_code = target.dataset.code;
          user_type = target.dataset.type;
          window.location.href = "detail.html?product_code=" + product_code;
        }

      }
    });
    $(window).scroll(function (e) {
      var scrollTop = $(window).scrollTop();
      var documentHeight = $(document).height();
      var windowHeight = $(window).height();
      if ((scrollTop >= (documentHeight - windowHeight)) && scrollTop > 550) {
        search.pager_offset += 1;
        var active = $(".active");
        if (active && active.length > 0 && active[0].dataset) {
          search.category_code = active[0].dataset.code;
        }

        if (isEnd) {
          $('.loading-more').hide()
          $('.loading-more1').show()
        } else {
          $('.loading-more1').hide()
          $('.loading-more').show()
          getPageList(search);
        }
      }
    });

    function getPageList() {
      $.ajax({
        type: "GET",
        url: "http://47.99.93.123:9090/rest/goodsList",
        dataType: "json",
        data: {
          keyword: search.product_name,
          pageSize: 20,
          pageIndex: search.pager_offset,
          sortName: search.sort,
          isCoupon: 0,
        },
        success: function (response) {
          var data = response.data.lists;
          console.log(data)
          loadItemComplete = true;
          if (data && data.length > 0) {
            $.each(data, function (index, item) {
              var imageUrl = item.imageInfo.imageList[0].url;
              var price = item.priceInfo.price ? item.priceInfo.price + '.00' : "0.00";
              if (imageUrl) {
                imageUrl = imageUrl.replace(/\\/g, "/");
              }
              $("div[name='product-list']").append("<div class='items'" +
                "' data-code='" + item.skuId +
                "'>" +
                "<img src=" + imageUrl +
                " data-code='" + item.skuId + "'>" +
                "<div class='infor posr' data-type='" + item.user_type +
                "' data-code='" + item.skuId + "'>" +
                "    <a href='#' class='desc' " +
                "' data-code='" + item.skuId + "'>" + item.skuName +
                "</a>" +
                "<p class='price-infor' data-code='" + item.skuId + "'>" +
                "<span class='price' data-code='" + item.skuId + "'>" + price +
                "</span><span class='price-unit'>NTOKEN/NUSD</span>" +
                "<span class='type tmall' data-code='" + item.skuId + "'>&nbsp;</span>" +
                "<span class=' tsales'>已售&nbsp;" + item.inOrderCount30Days + "</span>" +
                "</p>" +
                "<div class='coupon-infor fs'>50%积分回馈，相当于5折消费</div>" +
                "</div>" +
                "</div>"
              )
            });
            if (shop_class == 'taobao') {
              $('.menu-fixed,.tmall').removeClass('tianmao_shop').addClass('taobao_shop');
              $('.span1').html('淘宝');
              $('.swiper_taobao').show();
              $("#show_style").find('span').removeClass('browse-grid').addClass('browse-list')
              $('.product-list').find('.items').removeClass('item1').addClass('item')
            } else if (shop_class == 'tianmao') {
              $('.menu-fixed,.tmall').removeClass('taobao_shop').addClass('tianmao_shop');
              $('.span1').html('天猫');
              $('.swiper_tianmao').show();
              $("#show_style").find('span').removeClass('browse-list').addClass('browse-grid')
              $('.product-list').find('.items').removeClass('item').addClass('item1')
            }
            // if ($('#show_style').find('span').hasClass('browse-list')) {
            //   $('.product-list').find('.items').removeClass('item1').addClass('item')
            // } else {
            //   $('.product-list').find('.items').removeClass('item').addClass('item1')
            // }
            $("body").on("click", "#show_style .browse-list", function () {
              $(this).removeClass('browse-list').addClass('browse-grid')
              $('.product-list').find('.items').removeClass('item').addClass('item1')

            });
            $("body").on("click", "#show_style .browse-grid", function () {
              $(this).removeClass('browse-grid').addClass('browse-list')
              $('.product-list').find('.items').removeClass('item1').addClass('item')
            })
          } else {
            isEnd = true;
          }
        }
      });
    }
    var swiper = new Swiper('.swiper1', {
      observer: true,
      observeParents: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      autoplay: {
        delay: 2500,
        disableOnInteraction: false,
      },
      loop: true
    });

    var swiper = new Swiper('.swiper2', {

    });
  </script>
</body>

</html>